---
parameters:
  - name: configRef
    type: string
  - name: deploySteps
    type: stepList
    default: []
  - name: environment
    type: string
  - name: installSteps
    type: stepList
    default: []
  - name: organisationName
    type: string
  - name: serviceConnectionName
    type: string
  - name: workloadFeedName
    type: string

resources:
  repositories:
    - repository: self
    - repository: config
      type: git
      name: generated-set-config
      ref: ${{ split(parameters.configRef, '@')[1] }}

stages:
  - template: ../stages/deploy.yml
    parameters:
      configRef: ${{ parameters.configRef }}
      deploySteps: ${{ parameters.deploySteps }}
      environment: ${{ parameters.environment }}
      installSteps: ${{ parameters.installSteps }}
      organisationName: ${{ parameters.organisationName }}
      serviceConnectionName: ${{ parameters.serviceConnectionName }}
      workloadFeedName: ${{ parameters.workloadFeedName }}
